; Self-Testing Primitives Module
; Tests are first-class values that validate the language

; =============================================================================
; CORE LAMBDA CALCULUS TESTS
; =============================================================================

(â‰” test-cons
  (âŠ¨ :cons-creates-pair (âŸ¨âŸ© #1 #2) (âŸ¨âŸ© #1 #2)))

(â‰” test-car
  (âŠ¨ :car-extracts-first #1 (â— (âŸ¨âŸ© #1 #2))))

(â‰” test-cdr
  (âŠ¨ :cdr-extracts-second #2 (â–· (âŸ¨âŸ© #1 #2))))

(â‰” test-car-nested
  (âŠ¨ :car-nested #1 (â— (â— (âŸ¨âŸ© (âŸ¨âŸ© #1 #2) #3)))))

(â‰” test-cdr-nested
  (âŠ¨ :cdr-nested #3 (â–· (â— (âŸ¨âŸ© (âŸ¨âŸ© #1 #2) #3)))))

; =============================================================================
; ARITHMETIC TESTS
; =============================================================================

(â‰” test-add
  (âŠ¨ :add-simple #5 (âŠ• #2 #3)))

(â‰” test-sub
  (âŠ¨ :sub-simple #1 (âŠ– #3 #2)))

(â‰” test-mul
  (âŠ¨ :mul-simple #6 (âŠ— #2 #3)))

(â‰” test-div
  (âŠ¨ :div-simple #2 (âŠ˜ #6 #3)))

(â‰” test-mod
  (âŠ¨ :mod-simple #1 (% #7 #3)))

(â‰” test-div-by-zero
  (âŠ¨ :div-zero-error #t (âš ? (âŠ˜ #5 #0))))

(â‰” test-mod-by-zero
  (âŠ¨ :mod-zero-error #t (âš ? (% #5 #0))))

; =============================================================================
; COMPARISON TESTS
; =============================================================================

(â‰” test-eq-true
  (âŠ¨ :eq-numbers #t (â‰¡ #5 #5)))

(â‰” test-eq-false
  (âŠ¨ :neq-numbers #f (â‰¡ #5 #6)))

(â‰” test-neq
  (âŠ¨ :neq-op #t (â‰¢ #5 #6)))

(â‰” test-lt
  (âŠ¨ :less-than #t (< #3 #5)))

(â‰” test-gt
  (âŠ¨ :greater-than #t (> #5 #3)))

(â‰” test-lte
  (âŠ¨ :less-equal #t (â‰¤ #3 #3)))

(â‰” test-gte
  (âŠ¨ :greater-equal #t (â‰¥ #5 #5)))

; =============================================================================
; LOGIC TESTS
; =============================================================================

(â‰” test-and-true
  (âŠ¨ :and-both-true #t (âˆ§ #t #t)))

(â‰” test-and-false
  (âŠ¨ :and-one-false #f (âˆ§ #t #f)))

(â‰” test-or-true
  (âŠ¨ :or-one-true #t (âˆ¨ #f #t)))

(â‰” test-or-false
  (âŠ¨ :or-both-false #f (âˆ¨ #f #f)))

(â‰” test-not-true
  (âŠ¨ :not-true #f (Â¬ #t)))

(â‰” test-not-false
  (âŠ¨ :not-false #t (Â¬ #f)))

; =============================================================================
; TYPE PREDICATES
; =============================================================================

(â‰” test-number-pred
  (âŠ¨ :is-number #t (â„•? #42)))

(â‰” test-bool-pred
  (âŠ¨ :is-bool #t (ğ”¹? #t)))

(â‰” test-symbol-pred
  (âŠ¨ :is-symbol #t (:? :foo)))

(â‰” test-nil-pred
  (âŠ¨ :is-nil #t (âˆ…? âˆ…)))

(â‰” test-pair-pred
  (âŠ¨ :is-pair #t (âŸ¨âŸ©? (âŸ¨âŸ© #1 #2))))

(â‰” test-atom-pred
  (âŠ¨ :is-atom #t (#? #42)))

; =============================================================================
; ERROR HANDLING TESTS
; =============================================================================

(â‰” test-error-create
  (âŠ¨ :create-error #t (âš ? (âš  :test-error #42))))

(â‰” test-error-not-number
  (âŠ¨ :not-error #f (âš ? #42)))

(â‰” test-assert-true
  (âŠ¨ :assert-pass #t (âŠ¢ #t :should-pass)))

(â‰” test-assert-false
  (âŠ¨ :assert-fail #t (âš ? (âŠ¢ #f :should-fail))))

; =============================================================================
; DEEP EQUALITY TESTS
; =============================================================================

(â‰” test-deep-eq-numbers
  (âŠ¨ :deep-eq-num #t (â‰Ÿ #42 #42)))

(â‰” test-deep-eq-lists
  (âŠ¨ :deep-eq-list #t (â‰Ÿ (âŸ¨âŸ© #1 (âŸ¨âŸ© #2 âˆ…)) (âŸ¨âŸ© #1 (âŸ¨âŸ© #2 âˆ…)))))

(â‰” test-deep-neq-lists
  (âŠ¨ :deep-neq-list #f (â‰Ÿ (âŸ¨âŸ© #1 #2) (âŸ¨âŸ© #1 #3))))

; =============================================================================
; INTROSPECTION TESTS
; =============================================================================

(â‰” test-arity
  (âŠ¨ :arity-check #2 (â§‰ (Î» (x y) (âŠ• x y)))))

(â‰” test-trace
  (âŠ¨ :trace-returns-value #42 (âŸ² #42)))

; =============================================================================
; TEST SUITE RUNNER
; =============================================================================

; Collect all tests into a list
(â‰” all-primitive-tests (âŸ¨âŸ©
  test-cons
  (âŸ¨âŸ© test-car
  (âŸ¨âŸ© test-cdr
  (âŸ¨âŸ© test-car-nested
  (âŸ¨âŸ© test-cdr-nested
  (âŸ¨âŸ© test-add
  (âŸ¨âŸ© test-sub
  (âŸ¨âŸ© test-mul
  (âŸ¨âŸ© test-div
  (âŸ¨âŸ© test-mod
  (âŸ¨âŸ© test-div-by-zero
  (âŸ¨âŸ© test-mod-by-zero
  (âŸ¨âŸ© test-eq-true
  (âŸ¨âŸ© test-eq-false
  (âŸ¨âŸ© test-neq
  (âŸ¨âŸ© test-lt
  (âŸ¨âŸ© test-gt
  (âŸ¨âŸ© test-lte
  (âŸ¨âŸ© test-gte
  (âŸ¨âŸ© test-and-true
  (âŸ¨âŸ© test-and-false
  (âŸ¨âŸ© test-or-true
  (âŸ¨âŸ© test-or-false
  (âŸ¨âŸ© test-not-true
  (âŸ¨âŸ© test-not-false
  (âŸ¨âŸ© test-number-pred
  (âŸ¨âŸ© test-bool-pred
  (âŸ¨âŸ© test-symbol-pred
  (âŸ¨âŸ© test-nil-pred
  (âŸ¨âŸ© test-pair-pred
  (âŸ¨âŸ© test-atom-pred
  (âŸ¨âŸ© test-error-create
  (âŸ¨âŸ© test-error-not-number
  (âŸ¨âŸ© test-assert-true
  (âŸ¨âŸ© test-assert-false
  (âŸ¨âŸ© test-deep-eq-numbers
  (âŸ¨âŸ© test-deep-eq-lists
  (âŸ¨âŸ© test-deep-neq-lists
  (âŸ¨âŸ© test-arity
  (âŸ¨âŸ© test-trace
  âˆ…)))))))))))))))))))))))))))))))))))))))

; Run all tests - map each test through identity to evaluate
(â‰” run-all-tests (Î» (tests)
  (? (âˆ…? tests)
     âˆ…
     (âŸ¨âŸ© (â— tests) (run-all-tests (â–· tests))))))

; Count passing tests
(â‰” count-passing (Î» (results)
  (? (âˆ…? results)
     #0
     (? (â‰¡ (â— results) #t)
        (âŠ• #1 (count-passing (â–· results)))
        (count-passing (â–· results))))))

; Count total tests
(â‰” count-total (Î» (results)
  (? (âˆ…? results)
     #0
     (âŠ• #1 (count-total (â–· results))))))

; Main test runner
(â‰” test-primitives (Î» ()
  (â‰” results (run-all-tests all-primitive-tests))
  (â‰” total (count-total results))
  (â‰” passed (count-passing results))
  (âŸ¨âŸ© :total total (âŸ¨âŸ© :passed passed (âŸ¨âŸ© :failed (âŠ– total passed) âˆ…)))))

; Run tests!
; (test-primitives)
