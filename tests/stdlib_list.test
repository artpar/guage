; Standard Library List Operations Tests

; Load stdlib
; (This will be done via import in future, for now functions defined inline)

; ============================================================================
; Test Map (↦)
; ============================================================================

(≔ ↦ (λ (ƒ) (λ (lst)
  (? (∅? lst)
     ∅
     (⟨⟩ (ƒ (◁ lst)) ((↦ ƒ) (▷ lst)))))))

; Test: Map double
(⊨ (⌜ :map-double)
   (⟨⟩ #2 (⟨⟩ #4 (⟨⟩ #6 ∅)))
   ((↦ (λ (x) (⊗ x #2))) (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))))

; Test: Map increment
(⊨ (⌜ :map-inc)
   (⟨⟩ #2 (⟨⟩ #3 (⟨⟩ #4 ∅)))
   ((↦ (λ (x) (⊕ x #1))) (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))))

; Test: Map on empty list
(⊨ (⌜ :map-empty)
   ∅
   ((↦ (λ (x) (⊗ x #2))) ∅))

; ============================================================================
; Test Filter (⊲)
; ============================================================================

(≔ ⊲ (λ (pred) (λ (lst)
  (? (∅? lst)
     ∅
     (? (pred (◁ lst))
        (⟨⟩ (◁ lst) ((⊲ pred) (▷ lst)))
        ((⊲ pred) (▷ lst)))))))

; Test: Filter > 5
(⊨ (⌜ :filter-gt5)
   (⟨⟩ #7 (⟨⟩ #9 ∅))
   ((⊲ (λ (x) (> x #5))) (⟨⟩ #3 (⟨⟩ #7 (⟨⟩ #2 (⟨⟩ #9 ∅))))))

; Test: Filter even (using modulo would require it, so just test equality)
(⊨ (⌜ :filter-eq2)
   (⟨⟩ #2 (⟨⟩ #2 ∅))
   ((⊲ (λ (x) (≡ x #2))) (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 (⟨⟩ #2 ∅))))))

; Test: Filter on empty list
(⊨ (⌜ :filter-empty)
   ∅
   ((⊲ (λ (x) (> x #5))) ∅))

; ============================================================================
; Test Fold-Left (⊕←)
; ============================================================================

(≔ ⊕← (λ (ƒ) (λ (acc) (λ (lst)
  (? (∅? lst)
     acc
     (((⊕← ƒ) ((ƒ acc) (◁ lst))) (▷ lst)))))))

; Test: Sum using fold-left
(⊨ (⌜ :foldl-sum)
   #6
   (((⊕← (λ (a) (λ (b) (⊕ a b)))) #0) (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))))

; Test: Product using fold-left
(⊨ (⌜ :foldl-product)
   #24
   (((⊕← (λ (a) (λ (b) (⊗ a b)))) #1) (⟨⟩ #2 (⟨⟩ #3 (⟨⟩ #4 ∅)))))

; Test: Fold-left on empty list
(⊨ (⌜ :foldl-empty)
   #42
   (((⊕← (λ (a) (λ (b) (⊕ a b)))) #42) ∅))

; ============================================================================
; Test Fold-Right (⊕→)
; ============================================================================

(≔ ⊕→ (λ (ƒ) (λ (lst) (λ (acc)
  (? (∅? lst)
     acc
     ((ƒ (◁ lst)) (((⊕→ ƒ) (▷ lst)) acc)))))))

; Test: Build list using fold-right (cons all elements)
(⊨ (⌜ :foldr-cons)
   (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))
   (((⊕→ (λ (a) (λ (b) (⟨⟩ a b)))) (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))) ∅))

; Test: Fold-right on empty list
(⊨ (⌜ :foldr-empty)
   #42
   (((⊕→ (λ (a) (λ (b) (⊕ a b)))) ∅) #42))

; ============================================================================
; Test Length (#)
; ============================================================================

(≔ # (λ (lst)
  (((⊕← (λ (acc) (λ (_) (⊕ acc #1)))) #0) lst)))

; Test: Length of list
(⊨ (⌜ :length-3)
   #3
   (# (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))))

; Test: Length of empty list
(⊨ (⌜ :length-empty)
   #0
   (# ∅))

; ============================================================================
; Test Reverse (⇄)
; ============================================================================

(≔ ⇄ (λ (lst)
  (((⊕← (λ (acc) (λ (x) (⟨⟩ x acc)))) ∅) lst)))

; Test: Reverse list
(⊨ (⌜ :reverse-list)
   (⟨⟩ #3 (⟨⟩ #2 (⟨⟩ #1 ∅)))
   (⇄ (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))))

; Test: Reverse empty list
(⊨ (⌜ :reverse-empty)
   ∅
   (⇄ ∅))

; ============================================================================
; Test Range (⋯)
; ============================================================================

(≔ ⋯ (λ (end) (λ (start)
  (? (≥ start end)
     ∅
     (⟨⟩ start ((⋯ end) (⊕ start #1)))))))

; Test: Range 1 to 5
(⊨ (⌜ :range-1-5)
   (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 (⟨⟩ #4 ∅))))
   ((⋯ #5) #1))

; Test: Range empty (start >= end)
(⊨ (⌜ :range-empty)
   ∅
   ((⋯ #5) #5))

; ============================================================================
; Test Append (⧺)
; ============================================================================

(≔ ⧺ (λ (lst2) (λ (lst1)
  (((⊕→ (λ (a) (λ (b) (⟨⟩ a b)))) lst1) lst2))))

; Test: Append two lists
(⊨ (⌜ :append-lists)
   (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 (⟨⟩ #4 ∅))))
   ((⧺ (⟨⟩ #3 (⟨⟩ #4 ∅))) (⟨⟩ #1 (⟨⟩ #2 ∅))))

; Test: Append to empty
(⊨ (⌜ :append-empty)
   (⟨⟩ #1 (⟨⟩ #2 ∅))
   ((⧺ ∅) (⟨⟩ #1 (⟨⟩ #2 ∅))))

; ============================================================================
; Test Take (↑)
; ============================================================================

(≔ ↑ (λ (n) (λ (lst)
  (? (≡ n #0)
     ∅
     (? (∅? lst)
        ∅
        (⟨⟩ (◁ lst) ((↑ (⊖ n #1)) (▷ lst))))))))

; Test: Take 2 elements
(⊨ (⌜ :take-2)
   (⟨⟩ #1 (⟨⟩ #2 ∅))
   ((↑ #2) (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))))

; Test: Take 0 elements
(⊨ (⌜ :take-0)
   ∅
   ((↑ #0) (⟨⟩ #1 (⟨⟩ #2 ∅))))

; ============================================================================
; Test Drop (↓)
; ============================================================================

(≔ ↓ (λ (n) (λ (lst)
  (? (≡ n #0)
     lst
     (? (∅? lst)
        ∅
        ((↓ (⊖ n #1)) (▷ lst)))))))

; Test: Drop 2 elements
(⊨ (⌜ :drop-2)
   (⟨⟩ #3 ∅)
   ((↓ #2) (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))))

; Test: Drop 0 elements
(⊨ (⌜ :drop-0)
   (⟨⟩ #1 (⟨⟩ #2 ∅))
   ((↓ #0) (⟨⟩ #1 (⟨⟩ #2 ∅))))

; ============================================================================
; Test Zip (⊼)
; ============================================================================

(≔ ⊼ (λ (lst2) (λ (lst1)
  (? (∅? lst1)
     ∅
     (? (∅? lst2)
        ∅
        (⟨⟩ (⟨⟩ (◁ lst1) (◁ lst2)) ((⊼ (▷ lst2)) (▷ lst1))))))))

; Test: Zip two lists
(⊨ (⌜ :zip-lists)
   (⟨⟩ (⟨⟩ #1 #4) (⟨⟩ (⟨⟩ #2 #5) (⟨⟩ (⟨⟩ #3 #6) ∅)))
   ((⊼ (⟨⟩ #4 (⟨⟩ #5 (⟨⟩ #6 ∅)))) (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))))

; Test: Zip with different lengths
(⊨ (⌜ :zip-diff-len)
   (⟨⟩ (⟨⟩ #1 #3) (⟨⟩ (⟨⟩ #2 #4) ∅))
   ((⊼ (⟨⟩ #3 (⟨⟩ #4 ∅))) (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))))

; ============================================================================
; Test Exists (∃)
; ============================================================================

(≔ ∃ (λ (pred) (λ (lst)
  (? (∅? lst)
     #f
     (? (pred (◁ lst))
        #t
        ((∃ pred) (▷ lst)))))))

; Test: Exists finds element
(⊨ (⌜ :exists-found)
   #t
   ((∃ (λ (x) (> x #5))) (⟨⟩ #3 (⟨⟩ #7 (⟨⟩ #2 ∅)))))

; Test: Exists not found
(⊨ (⌜ :exists-not-found)
   #f
   ((∃ (λ (x) (> x #10))) (⟨⟩ #3 (⟨⟩ #7 (⟨⟩ #2 ∅)))))

; ============================================================================
; Test Forall (∀)
; ============================================================================

(≔ ∀ (λ (pred) (λ (lst)
  (? (∅? lst)
     #t
     (? (pred (◁ lst))
        ((∀ pred) (▷ lst))
        #f)))))

; Test: Forall all satisfy
(⊨ (⌜ :forall-all)
   #t
   ((∀ (λ (x) (> x #0))) (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))))

; Test: Forall not all satisfy
(⊨ (⌜ :forall-not-all)
   #f
   ((∀ (λ (x) (> x #1))) (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))))

; ============================================================================
; Test Contains (∈)
; ============================================================================

(≔ ∈ (λ (elem) (λ (lst)
  ((∃ (λ (x) (≡ elem x))) lst))))

; Test: Contains element
(⊨ (⌜ :contains-found)
   #t
   ((∈ #2) (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))))

; Test: Contains not found
(⊨ (⌜ :contains-not-found)
   #f
   ((∈ #5) (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))))

; ============================================================================
; Test Replicate (⊚⊚)
; ============================================================================

(≔ ⊚⊚ (λ (val) (λ (n)
  (? (≡ n #0)
     ∅
     (⟨⟩ val ((⊚⊚ val) (⊖ n #1)))))))

; Test: Replicate 3 times
(⊨ (⌜ :replicate-3)
   (⟨⟩ #7 (⟨⟩ #7 (⟨⟩ #7 ∅)))
   ((⊚⊚ #7) #3))

; Test: Replicate 0 times
(⊨ (⌜ :replicate-0)
   ∅
   ((⊚⊚ #7) #0))

::stdlib-list-tests-complete
