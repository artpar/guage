; Structure Symbol Parsing Test Suite
; Tests that keywords (:symbol) self-evaluate and work from files
; This tests the fix from commit 7309002

; ===== SECTION 1: Keyword Self-Evaluation =====

; Test 1: Simple keyword self-evaluates
(⊨ (⌜ :keyword-self-eval⌝)
   :test
   :test)

; Test 2: Keyword with capital letters
(⊨ (⌜ :keyword-capitals⌝)
   :Point
   :Point)

; Test 3: Keyword with numbers
(⊨ (⌜ :keyword-numbers⌝)
   :x1
   :x1)

; Test 4: Keyword in pair
(⊨ (⌜ :keyword-in-pair⌝)
   :key
   (◁ (⟨⟩ :key #42)))

; Test 5: Multiple keywords
(⊨ (⌜ :multiple-keywords⌝)
   :second
   (◁ (▷ (⟨⟩ :first (⟨⟩ :second ∅)))))

; ===== SECTION 2: Structure Definition with Keywords =====

; Test 6: Define structure with keyword type name
(⊙≔ :Point :x :y)
(⊨ (⌜ :define-point-struct⌝)
   :Point
   :Point)

; Test 7: Define structure with multiple fields
(⊙≔ :Rectangle :x :y :width :height)
(⊨ (⌜ :define-rectangle-struct⌝)
   :Rectangle
   :Rectangle)

; Test 8: Define structure with single field
(⊙≔ :Wrapper :value)
(⊨ (⌜ :define-wrapper-struct⌝)
   :Wrapper
   :Wrapper)

; ===== SECTION 3: Structure Creation with Keywords =====

; Test 9: Create Point instance
(≔ p1 (⊙ :Point #3 #4))
(⊨ (⌜ :create-point⌝)
   #t
   (⊙? p1 :Point))

; Test 10: Create Rectangle instance
(≔ r1 (⊙ :Rectangle #0 #0 #10 #20))
(⊨ (⌜ :create-rectangle⌝)
   #t
   (⊙? r1 :Rectangle))

; Test 11: Create Wrapper instance
(≔ w1 (⊙ :Wrapper #42))
(⊨ (⌜ :create-wrapper⌝)
   #t
   (⊙? w1 :Wrapper))

; ===== SECTION 4: Field Access with Keywords =====

; Test 12: Get x field from Point
(⊨ (⌜ :get-point-x⌝)
   #3
   (⊙→ p1 :x))

; Test 13: Get y field from Point
(⊨ (⌜ :get-point-y⌝)
   #4
   (⊙→ p1 :y))

; Test 14: Get width from Rectangle
(⊨ (⌜ :get-rect-width⌝)
   #10
   (⊙→ r1 :width))

; Test 15: Get height from Rectangle
(⊨ (⌜ :get-rect-height⌝)
   #20
   (⊙→ r1 :height))

; Test 16: Get value from Wrapper
(⊨ (⌜ :get-wrapper-value⌝)
   #42
   (⊙→ w1 :value))

; ===== SECTION 5: Field Update with Keywords =====

; Test 17: Update Point x field
(≔ p2 (⊙← p1 :x #10))
(⊨ (⌜ :update-point-x⌝)
   #10
   (⊙→ p2 :x))

; Test 18: Original Point unchanged (immutability)
(⊨ (⌜ :point-immutable⌝)
   #3
   (⊙→ p1 :x))

; Test 19: Update Rectangle width
(≔ r2 (⊙← r1 :width #30))
(⊨ (⌜ :update-rect-width⌝)
   #30
   (⊙→ r2 :width))

; Test 20: Original Rectangle unchanged
(⊨ (⌜ :rect-immutable⌝)
   #10
   (⊙→ r1 :width))

; ===== SECTION 6: Type Checking with Keywords =====

; Test 21: Type check Point
(⊨ (⌜ :type-check-point⌝)
   #t
   (⊙? p1 :Point))

; Test 22: Type check Rectangle
(⊨ (⌜ :type-check-rect⌝)
   #t
   (⊙? r1 :Rectangle))

; Test 23: Type check Wrapper
(⊨ (⌜ :type-check-wrapper⌝)
   #t
   (⊙? w1 :Wrapper))

; Test 24: Wrong type check fails
(⊨ (⌜ :wrong-type-check⌝)
   #f
   (⊙? p1 :Rectangle))

; Test 25: Non-structure fails type check
(⊨ (⌜ :non-struct-type-check⌝)
   #f
   (⊙? #42 :Point))

; ===== SECTION 7: Complex Structures =====

; Test 26: Structure with structure field
(⊙≔ :Line :start :end)
(≔ line1 (⊙ :Line p1 p2))
(⊨ (⌜ :struct-with-struct⌝)
   #t
   (⊙? line1 :Line))

; Test 27: Access nested structure
(⊨ (⌜ :nested-struct-access⌝)
   #3
   (⊙→ (⊙→ line1 :start) :x))

; Test 28: Deep nesting
(⊨ (⌜ :deep-nesting⌝)
   #4
   (⊙→ (⊙→ line1 :start) :y))

; ===== SECTION 8: Practical Examples =====

; Test 29: Color structure
(⊙≔ :Color :red :green :blue)
(≔ red-color (⊙ :Color #255 #0 #0))
(⊨ (⌜ :color-red⌝)
   #255
   (⊙→ red-color :red))

; Test 30: Person structure
(⊙≔ :Person :name :age)
(≔ person (⊙ :Person :Alice #30))
(⊨ (⌜ :person-age⌝)
   #30
   (⊙→ person :age))

; ===== SECTION 9: Keywords in Expressions =====

; Test 31: Keyword in conditional
(⊨ (⌜ :keyword-in-cond⌝)
   :yes
   (? #t :yes :no))

; Test 32: Keyword equality
(⊨ (⌜ :keyword-equality⌝)
   #t
   (≡ :test :test))

; Test 33: Keyword inequality
(⊨ (⌜ :keyword-inequality⌝)
   #f
   (≡ :test :other))

; Test 34: Keyword in list
(≔ sym-list (⟨⟩ :first (⟨⟩ :second (⟨⟩ :third ∅))))
(⊨ (⌜ :keyword-in-list⌝)
   :second
   (◁ (▷ sym-list)))

; ===== SECTION 10: Edge Cases =====

; Test 35: Empty keyword field name (if allowed)
; Skipped - colon alone might not be valid

; Test 36: Keyword with underscore
(⊙≔ :Data :field_name)
(≔ d1 (⊙ :Data #100))
(⊨ (⌜ :keyword-underscore⌝)
   #100
   (⊙→ d1 :field_name))

; Test 37: Keyword with dash
(⊙≔ :Config :max-value)
(≔ cfg (⊙ :Config #1000))
(⊨ (⌜ :keyword-dash⌝)
   #1000
   (⊙→ cfg :max-value))

; Test 38: Many fields structure
(⊙≔ :ManyFields :a :b :c :d :e)
(≔ mf (⊙ :ManyFields #1 #2 #3 #4 #5))
(⊨ (⌜ :many-fields⌝)
   #3
   (⊙→ mf :c))

; Test 39: Structure update multiple times
(≔ p3 (⊙← p1 :x #5))
(≔ p4 (⊙← p3 :y #6))
(⊨ (⌜ :multiple-updates⌝)
   #5
   (⊙→ p4 :x))

; Test 40: Verify multiple update preserves other field
(⊨ (⌜ :multiple-updates-preserve⌝)
   #6
   (⊙→ p4 :y))

; ===== SUMMARY =====
; Total: 40 structure symbol tests
; Coverage:
;   - Keyword self-evaluation (5 tests)
;   - Structure definition (3 tests)
;   - Structure creation (3 tests)
;   - Field access (5 tests)
;   - Field update (4 tests)
;   - Type checking (5 tests)
;   - Complex structures (3 tests)
;   - Practical examples (2 tests)
;   - Keywords in expressions (4 tests)
;   - Edge cases (6 tests)
;
; This suite verifies that keywords (:symbol) work correctly from files,
; testing the fix from commit 7309002 where keywords became self-evaluating.
