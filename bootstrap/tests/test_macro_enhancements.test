; Test macro system enhancements (Day 70)
; Tests for: gensym (gensym), macro-expand (macro-expand), macro-list (macro-list)

; ========== Gensym Tests ==========

; Test 1: gensym generates symbols
(test-case :gensym-basic #t
    (symbol? (gensym)))

; Test 2: gensym with no args uses default prefix
(define g1 (gensym))
(test-case :gensym-default-prefix #t
    (symbol? g1))

; Test 3: gensym with custom prefix
(define g2 (gensym "test"))
(test-case :gensym-custom-prefix #t
    (symbol? g2))

; Test 4: gensym generates unique symbols
(define g3 (gensym))
(define g4 (gensym))
(test-case :gensym-unique #f
    (equal? g3 g4))

; Test 5: gensym with symbol prefix
(define g5 (gensym :var))
(test-case :gensym-symbol-prefix #t
    (symbol? g5))

; ========== Macro List Tests ==========

; Define test macros
(macro test-when (c b)
  (quasiquote-tilde (if (~ c) (~ b) nil)))

(macro test-unless (c b)
  (quasiquote-tilde (if (~ c) nil (~ b))))

; Test 6: macro-list returns a list
(test-case :macro-list-is-list #t
    (pair? (macro-list)))

; Test 7: defined macros appear in list
(define macros (macro-list))
(test-case :macro-list-not-empty #t
    (not (null? macros)))

; ========== Macro Expand Tests ==========

; Test 8: expand once on non-macro returns same
(test-case :expand-non-macro #42
    (macro-expand (quote #42)))

; Test 9: expand on simple macro call
(test-case :expand-simple-macro-is-list #t
    (pair? (macro-expand (quote (test-when #t #42)))))

; Test 10: expand preserves literal structure
(test-case :expand-literal #5
    (macro-expand (quote #5)))
