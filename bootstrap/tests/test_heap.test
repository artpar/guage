; Test: Priority Queue (heap) — Binary Min-Heap
; Day 115

; 1. Empty creation + size + empty predicate
(test-case (quote :heap-new-empty) #0 (heap-size (heap)))
(test-case (quote :heap-empty-pred) #t (heap-empty? (heap)))

; 2. Push + peek returns min priority
(define h1 (heap))
(heap-push! h1 #5 :five)
(heap-push! h1 #2 :two)
(heap-push! h1 #8 :eight)
(test-case (quote :heap-peek-min-priority) #2 (car (heap-peek h1)))
(test-case (quote :heap-peek-min-value) :two (cdr (heap-peek h1)))

; 3. Pop returns min and removes it
(define h2 (heap))
(heap-push! h2 #10 :ten)
(heap-push! h2 #3 :three)
(heap-push! h2 #7 :seven)
(define popped (heap-pop! h2))
(test-case (quote :heap-pop-priority) #3 (car popped))
(test-case (quote :heap-pop-value) :three (cdr popped))
(test-case (quote :heap-size-after-pop) #2 (heap-size h2))

; 4. Pop order is sorted
(define h3 (heap))
(heap-push! h3 #30 :c)
(heap-push! h3 #10 :a)
(heap-push! h3 #20 :b)
(test-case (quote :heap-pop-order-1) :a (cdr (heap-pop! h3)))
(test-case (quote :heap-pop-order-2) :b (cdr (heap-pop! h3)))
(test-case (quote :heap-pop-order-3) :c (cdr (heap-pop! h3)))

; 5. Type predicate
(test-case (quote :heap-type-pred-yes) #t (heap? (heap)))
(test-case (quote :heap-type-pred-no) #f (heap? #42))

; 6. Empty errors
(test-case (quote :heap-pop-empty) #t (error? (heap-pop! (heap))))
(test-case (quote :heap-peek-empty) nil (heap-peek (heap)))

; 7. To-list returns sorted pairs
(define h4 (heap))
(heap-push! h4 #3 :c)
(heap-push! h4 #1 :a)
(heap-push! h4 #2 :b)
(define sorted (heap->list h4))
(test-case (quote :heap-to-list-first) :a (cdr (car sorted)))

; 8. Merge two heaps
(define ha (heap))
(heap-push! ha #5 :five)
(heap-push! ha #1 :one)
(define hb (heap))
(heap-push! hb #3 :three)
(heap-push! hb #2 :two)
(define hm (heap-merge ha hb))
(test-case (quote :heap-merge-size) #4 (heap-size hm))
(test-case (quote :heap-merge-min) :one (cdr (heap-peek hm)))

; 9. Duplicate priorities
(define h5 (heap))
(heap-push! h5 #1 :first)
(heap-push! h5 #1 :second)
(test-case (quote :heap-dup-size) #2 (heap-size h5))
(test-case (quote :heap-dup-priority) #1 (car (heap-pop! h5)))

; 10. Large heap — push 10 elements, pop all in order
(define h6 (heap))
(heap-push! h6 #9 :i)
(heap-push! h6 #4 :d)
(heap-push! h6 #7 :g)
(heap-push! h6 #1 :a)
(heap-push! h6 #5 :e)
(heap-push! h6 #3 :c)
(heap-push! h6 #8 :h)
(heap-push! h6 #2 :b)
(heap-push! h6 #6 :f)
(heap-push! h6 #10 :j)
(test-case (quote :heap-large-size) #10 (heap-size h6))
(test-case (quote :heap-large-pop-1) :a (cdr (heap-pop! h6)))
(test-case (quote :heap-large-pop-2) :b (cdr (heap-pop! h6)))
(test-case (quote :heap-large-pop-3) :c (cdr (heap-pop! h6)))
