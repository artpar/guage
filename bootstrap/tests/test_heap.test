; Test: Priority Queue (△) — Binary Min-Heap
; Day 115

; 1. Empty creation + size + empty predicate
(⊨ (⌜ :heap-new-empty) #0 (△# (△)))
(⊨ (⌜ :heap-empty-pred) #t (△∅? (△)))

; 2. Push + peek returns min priority
(≔ h1 (△))
(△⊕ h1 #5 :five)
(△⊕ h1 #2 :two)
(△⊕ h1 #8 :eight)
(⊨ (⌜ :heap-peek-min-priority) #2 (◁ (△◁ h1)))
(⊨ (⌜ :heap-peek-min-value) :two (▷ (△◁ h1)))

; 3. Pop returns min and removes it
(≔ h2 (△))
(△⊕ h2 #10 :ten)
(△⊕ h2 #3 :three)
(△⊕ h2 #7 :seven)
(≔ popped (△⊖ h2))
(⊨ (⌜ :heap-pop-priority) #3 (◁ popped))
(⊨ (⌜ :heap-pop-value) :three (▷ popped))
(⊨ (⌜ :heap-size-after-pop) #2 (△# h2))

; 4. Pop order is sorted
(≔ h3 (△))
(△⊕ h3 #30 :c)
(△⊕ h3 #10 :a)
(△⊕ h3 #20 :b)
(⊨ (⌜ :heap-pop-order-1) :a (▷ (△⊖ h3)))
(⊨ (⌜ :heap-pop-order-2) :b (▷ (△⊖ h3)))
(⊨ (⌜ :heap-pop-order-3) :c (▷ (△⊖ h3)))

; 5. Type predicate
(⊨ (⌜ :heap-type-pred-yes) #t (△? (△)))
(⊨ (⌜ :heap-type-pred-no) #f (△? #42))

; 6. Empty errors
(⊨ (⌜ :heap-pop-empty) #t (⚠? (△⊖ (△))))
(⊨ (⌜ :heap-peek-empty) ∅ (△◁ (△)))

; 7. To-list returns sorted pairs
(≔ h4 (△))
(△⊕ h4 #3 :c)
(△⊕ h4 #1 :a)
(△⊕ h4 #2 :b)
(≔ sorted (△⊙ h4))
(⊨ (⌜ :heap-to-list-first) :a (▷ (◁ sorted)))

; 8. Merge two heaps
(≔ ha (△))
(△⊕ ha #5 :five)
(△⊕ ha #1 :one)
(≔ hb (△))
(△⊕ hb #3 :three)
(△⊕ hb #2 :two)
(≔ hm (△⊕* ha hb))
(⊨ (⌜ :heap-merge-size) #4 (△# hm))
(⊨ (⌜ :heap-merge-min) :one (▷ (△◁ hm)))

; 9. Duplicate priorities
(≔ h5 (△))
(△⊕ h5 #1 :first)
(△⊕ h5 #1 :second)
(⊨ (⌜ :heap-dup-size) #2 (△# h5))
(⊨ (⌜ :heap-dup-priority) #1 (◁ (△⊖ h5)))

; 10. Large heap — push 10 elements, pop all in order
(≔ h6 (△))
(△⊕ h6 #9 :i)
(△⊕ h6 #4 :d)
(△⊕ h6 #7 :g)
(△⊕ h6 #1 :a)
(△⊕ h6 #5 :e)
(△⊕ h6 #3 :c)
(△⊕ h6 #8 :h)
(△⊕ h6 #2 :b)
(△⊕ h6 #6 :f)
(△⊕ h6 #10 :j)
(⊨ (⌜ :heap-large-size) #10 (△# h6))
(⊨ (⌜ :heap-large-pop-1) :a (▷ (△⊖ h6)))
(⊨ (⌜ :heap-large-pop-2) :b (▷ (△⊖ h6)))
(⊨ (⌜ :heap-large-pop-3) :c (▷ (△⊖ h6)))
