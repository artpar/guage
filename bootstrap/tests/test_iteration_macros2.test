; ═══════════════════════════════════════════════════════════════
; Test: Iteration Macros - Part 2 (Day 81)
; ═══════════════════════════════════════════════════════════════
; Tests for stdlib iteration/sequencing macros (continued)
; - ⊎⊲ (filter comprehension)
; - Nested/combined usage
; - ⟳← (reduce)
; ═══════════════════════════════════════════════════════════════

(load "bootstrap/stdlib/macros_iteration.scm")

; ═══════════════════════════════════════════════════════════════
; ⊎⊲ (list filter comprehension) - Filter with inline predicate
; ═══════════════════════════════════════════════════════════════

; Filter even numbers
(test-case (quote :filtercomp-even)
   (cons #2 (cons #4 nil))
   (⊎⊲ (equal? (% :x #2) #0) (:x (cons #1 (cons #2 (cons #3 (cons #4 (cons #5 nil))))))))

; Filter greater than 3
(test-case (quote :filtercomp-gt3)
   (cons #4 (cons #5 nil))
   (⊎⊲ (> :x #3) (:x (cons #1 (cons #2 (cons #3 (cons #4 (cons #5 nil))))))))

; Filter all pass
(test-case (quote :filtercomp-all)
   (cons #1 (cons #2 (cons #3 nil)))
   (⊎⊲ #t (:x (cons #1 (cons #2 (cons #3 nil))))))

; Filter none pass
(test-case (quote :filtercomp-none)
   nil
   (⊎⊲ #f (:x (cons #1 (cons #2 (cons #3 nil))))))

; ═══════════════════════════════════════════════════════════════
; Nested/Combined Usage
; ═══════════════════════════════════════════════════════════════

; Begin inside list comprehension body
(test-case (quote :nested-begin-in-comp)
   (cons #3 (cons #6 (cons #9 nil)))
   (⊎↦ (⊎ (* :x #2) (* :x #3)) (:x (cons #1 (cons #2 (cons #3 nil))))))

; List comprehension with begin for tracing
(test-case (quote :comp-with-trace)
   (cons #10 (cons #20 nil))
   (⊎↦ (⊎ (trace :processing) (* :n #10)) (:n (cons #1 (cons #2 nil)))))

; ═══════════════════════════════════════════════════════════════
; ⟳← (reduce) - Fold with cleaner syntax
; ═══════════════════════════════════════════════════════════════

; Sum using reduce
(test-case (quote :reduce-sum)
   #15
   (⟳← (+ :acc :x) #0 (:x (cons #1 (cons #2 (cons #3 (cons #4 (cons #5 nil))))))))

; Product using reduce
(test-case (quote :reduce-product)
   #120
   (⟳← (* :acc :x) #1 (:x (cons #1 (cons #2 (cons #3 (cons #4 (cons #5 nil))))))))

; Max using reduce
(test-case (quote :reduce-max)
   #9
   (⟳← (if (> :x :acc) :x :acc) #0 (:x (cons #3 (cons #1 (cons #9 (cons #4 nil)))))))

; Count using reduce
(test-case (quote :reduce-count)
   #5
   (⟳← (+ :acc #1) #0 (:x (cons :a (cons :b (cons :c (cons :d (cons :e nil))))))))

; Empty list reduce
(test-case (quote :reduce-empty)
   #42
   (⟳← (+ :acc :x) #42 (:x nil)))

; ═══════════════════════════════════════════════════════════════
; Summary: 11 iteration macro tests (Part 2)
; ═══════════════════════════════════════════════════════════════

"✓ 11 iteration macro tests (Part 2) passed"
