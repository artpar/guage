#!/usr/bin/env guage
; Test suite for Day 121 String SDK — 20 SIMD-accelerated primitives
; Tests all tiers: Search, Transform, Trim, Split, Pad, Strip

(print "Testing String SDK (Day 121)...")

; ============================================================================
; Tier 1: Search — ≈⊳, ≈⊲, ≈∈?, ≈⊲?, ≈⊳?, string-count
; ============================================================================

(print "  Tier 1: Search...")

; string-find find
(test-case :find-basic #6 (string-find "hello world" "world"))
(test-case :find-start #0 (string-find "hello world" "hello"))
(test-case :find-not-found nil (string-find "hello" "xyz"))
(test-case :find-empty-needle #0 (string-find "hello" ""))
(test-case :find-single-char #4 (string-find "hello" "o"))
(test-case :find-first-occ #0 (string-find "abcabc" "abc"))

; string-rfind rfind
(test-case :rfind-basic #6 (string-rfind "hello world" "world"))
(test-case :rfind-last #3 (string-rfind "abcabc" "abc"))
(test-case :rfind-not-found nil (string-rfind "hello" "xyz"))
(test-case :rfind-single-char #4 (string-rfind "hello" "o"))

; string-contains? contains
(test-case :contains-true #t (string-contains? "hello world" "world"))
(test-case :contains-false #f (string-contains? "hello" "xyz"))
(test-case :contains-empty #t (string-contains? "hello" ""))

; string-starts-with? starts-with
(test-case :starts-with-match #t (string-starts-with? "hello world" "hello"))
(test-case :starts-with-no-match #f (string-starts-with? "hello world" "world"))
(test-case :starts-with-empty #t (string-starts-with? "hello" ""))
(test-case :starts-with-longer #f (string-starts-with? "hi" "hello"))

; string-ends-with? ends-with
(test-case :ends-with-match #t (string-ends-with? "hello world" "world"))
(test-case :ends-with-no-match #f (string-ends-with? "hello world" "hello"))
(test-case :ends-with-empty #t (string-ends-with? "hello" ""))
(test-case :ends-with-longer #f (string-ends-with? "hi" "hello"))

; string-count count
(test-case :count-multiple #3 (string-count "abcabcabc" "abc"))
(test-case :count-zero #0 (string-count "hello" "xyz"))
(test-case :count-single-char #2 (string-count "hello" "l"))
(test-case :count-one #1 (string-count "hello world" "world"))

; ============================================================================
; Tier 2: Transform — ≈⇄, ≈⊛, ≈⇔, string-replace-n
; ============================================================================

(print "  Tier 2: Transform...")

; string-reverse reverse
(test-case :reverse-basic "olleh" (string-reverse "hello"))
(test-case :reverse-empty "" (string-reverse ""))
(test-case :reverse-single "a" (string-reverse "a"))
(test-case :reverse-palindrome "aba" (string-reverse "aba"))

; string-repeat repeat
(test-case :repeat-3 "abcabcabc" (string-repeat "abc" #3))
(test-case :repeat-0 "" (string-repeat "abc" #0))
(test-case :repeat-1 "abc" (string-repeat "abc" #1))
(test-case :repeat-empty "" (string-repeat "" #5))

; string-replace replace
(test-case :replace-basic "hello there" (string-replace "hello world" "world" "there"))
(test-case :replace-all "bbb" (string-replace "aaa" "a" "b"))
(test-case :replace-not-found "hello" (string-replace "hello" "xyz" "abc"))
(test-case :replace-delete "heo" (string-replace "hello" "l" ""))

; string-replace-n replacen
(test-case :replacen-first-2 "bb" (string-replace-n "abcabc" "abc" "b" #2))
(test-case :replacen-first-1 "babcabc" (string-replace-n "abcabcabc" "abc" "b" #1))

; ============================================================================
; Tier 3: Trim — ≈⊏, ≈⊐, string-trim
; ============================================================================

(print "  Tier 3: Trim...")

; string-trim-left trim-left
(test-case :trim-left-spaces "hello" (string-trim-left "  hello"))
(test-case :trim-left-tabs "hello" (string-trim-left "\thello"))
(test-case :trim-left-mixed "hello" (string-trim-left " \t\nhello"))
(test-case :trim-left-none "hello" (string-trim-left "hello"))
(test-case :trim-left-all "" (string-trim-left "   "))

; string-trim-right trim-right
(test-case :trim-right-spaces "hello" (string-trim-right "hello  "))
(test-case :trim-right-tabs "hello" (string-trim-right "hello\t"))
(test-case :trim-right-none "hello" (string-trim-right "hello"))
(test-case :trim-right-all "" (string-trim-right "   "))

; string-trim trim
(test-case :trim-both "hello" (string-trim "  hello  "))
(test-case :trim-mixed "hello" (string-trim "\t\n hello \n\t"))
(test-case :trim-none "hello" (string-trim "hello"))

; ============================================================================
; Tier 4: Split — ≈÷, ≈÷#, string-fields
; ============================================================================

(print "  Tier 4: Split...")

; string-split split
(test-case :split-basic
   (cons "a" (cons "b" (cons "c" nil)))
   (string-split "a,b,c" ","))
(test-case :split-chars
   (cons "h" (cons "e" (cons "l" (cons "l" (cons "o" nil)))))
   (string-split "hello" ""))
(test-case :split-not-found
   (cons "hello" nil)
   (string-split "hello" ","))
(test-case :split-empty nil (string-split "" ","))
(test-case :split-multi-delim
   (cons "hello" (cons "world" nil))
   (string-split "hello::world" "::"))

; string-split-n splitn
(test-case :splitn-3-parts
   (cons "a" (cons "b" (cons "c,d" nil)))
   (string-split-n "a,b,c,d" "," #3))
(test-case :splitn-1
   (cons "a,b,c" nil)
   (string-split-n "a,b,c" "," #1))

; string-fields fields
(test-case :fields-basic
   (cons "hello" (cons "world" nil))
   (string-fields "hello world"))
(test-case :fields-multi-space
   (cons "hello" (cons "world" nil))
   (string-fields "  hello   world  "))
(test-case :fields-tabs
   (cons "a" (cons "b" (cons "c" nil)))
   (string-fields "a\tb\tc"))
(test-case :fields-mixed-ws
   (cons "hello" (cons "world" nil))
   (string-fields "\t hello \n world \r"))

; ============================================================================
; Tier 5: Pad — ≈⊏⊕, string-pad-right
; ============================================================================

(print "  Tier 5: Pad...")

; string-pad-left pad-left
(test-case :pad-left-basic "000hi" (string-pad-left "hi" #5 "0"))
(test-case :pad-left-already "hello" (string-pad-left "hello" #3 "0"))
(test-case :pad-left-exact "hello" (string-pad-left "hello" #5 "0"))

; string-pad-right pad-right
(test-case :pad-right-basic "hi000" (string-pad-right "hi" #5 "0"))
(test-case :pad-right-already "hello" (string-pad-right "hello" #3 "0"))
(test-case :pad-right-space "hi   " (string-pad-right "hi" #5 " "))

; ============================================================================
; Tier 6: Strip — ≈⊏⊖, string-strip-suffix
; ============================================================================

(print "  Tier 6: Strip...")

; string-strip-prefix strip-prefix
(test-case :strip-prefix-match "world" (string-strip-prefix "hello world" "hello "))
(test-case :strip-prefix-no-match "hello world" (string-strip-prefix "hello world" "xyz"))
(test-case :strip-prefix-empty "hello" (string-strip-prefix "hello" ""))

; string-strip-suffix strip-suffix
(test-case :strip-suffix-match "hello" (string-strip-suffix "hello world" " world"))
(test-case :strip-suffix-no-match "hello world" (string-strip-suffix "hello world" "xyz"))
(test-case :strip-suffix-empty "hello" (string-strip-suffix "hello" ""))

; ============================================================================
; Integration: long-name aliases via stdlib
; ============================================================================

(print "  Integration: aliases...")

(load "bootstrap/stdlib/string.scm")

(test-case :alias-split
   (cons "a" (cons "b" nil))
   (string-split "a,b" ","))

(test-case :alias-contains #t (string-contains? "hello world" "world"))
(test-case :alias-replace "hi there" (string-replace "hi world" "world" "there"))
(test-case :alias-trim "hello" (string-trim "  hello  "))
(test-case :alias-index-of #6 (string-index-of "hello world" "world"))
(test-case :alias-starts-with #t (string-starts-with? "hello" "hel"))
(test-case :alias-ends-with #t (string-ends-with? "hello" "llo"))
(test-case :alias-reverse "olleh" (string-reverse "hello"))
(test-case :alias-fields
   (cons "a" (cons "b" nil))
   (string-fields "  a  b  "))

(print "\n✅ All Day 121 String SDK tests passed!")
