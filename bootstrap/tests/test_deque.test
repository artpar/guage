; Test: Deque (deque) â€” DPDK-grade cache-optimized circular buffer
; Day 111

(test-case (quote :deque-new-empty) #t (and (equal? (deque-size (deque)) #0) (deque-empty? (deque))))

(test-case (quote :deque-new-from-values) #3 (deque-size (deque #1 #2 #3)))

(define d1 (deque))
(deque-push-back d1 #1)
(deque-push-back d1 #2)
(deque-push-back d1 #3)
(test-case (quote :deque-push-pop-back) #t
  (and (equal? (deque-pop-back d1) #3) (and (equal? (deque-pop-back d1) #2) (equal? (deque-pop-back d1) #1))))

(define d2 (deque))
(deque-push-front d2 #1)
(deque-push-front d2 #2)
(deque-push-front d2 #3)
(test-case (quote :deque-push-pop-front) #t
  (and (equal? (deque-pop-front d2) #3) (and (equal? (deque-pop-front d2) #2) (equal? (deque-pop-front d2) #1))))

(define d3 (deque))
(deque-push-back d3 #1)
(deque-push-back d3 #2)
(deque-push-back d3 #3)
(test-case (quote :deque-fifo-queue) #t
  (and (equal? (deque-pop-front d3) #1) (and (equal? (deque-pop-front d3) #2) (equal? (deque-pop-front d3) #3))))

(define d4 (deque #10 #20 #30))
(test-case (quote :deque-peek-no-remove) #t
  (and (equal? (deque-peek-front d4) #10) (and (equal? (deque-peek-back d4) #30) (equal? (deque-size d4) #3))))

(define d5 (deque))
(test-case (quote :deque-empty-predicate) #t (deque-empty? d5))
(deque-push-back d5 #1)
(test-case (quote :deque-empty-after-push) #f (deque-empty? d5))
(deque-pop-front d5)
(test-case (quote :deque-empty-after-pop-all) #t (deque-empty? d5))

(define d6 (deque #1 #2 #3))
(define lst (deque-to-list d6))
(test-case (quote :deque-to-list) #t
  (and (equal? (car lst) #1) (and (equal? (car (cdr lst)) #2) (equal? (car (cdr (cdr lst))) #3))))

(test-case (quote :deque-type-predicate) #t (and (deque? (deque)) (not (deque? #42))))

(test-case (quote :deque-pop-empty-error) #t
  (and (error? (deque-pop-front (deque))) (error? (deque-pop-back (deque)))))
