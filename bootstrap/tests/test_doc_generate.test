;;;
;;; Tests for Documentation Generation (Day 63)
;;;

;;; ===================================================================
;;; Test 1: Generate docs for simple module
;;; ===================================================================

; Create a simple test module
(â‰‹âŠ² "/tmp/test_doc_module.scm" "(â‰” double (Î» (n) (âŠ— n #2))) (â‰” square (Î» (n) (âŠ— n n)))")

; Load the module
(â‹˜ "/tmp/test_doc_module.scm")

; Generate documentation
(â‰” doc (ðŸ“– "/tmp/test_doc_module.scm"))

; Verify it's a string
(âŠ¨ :doc-generate-returns-string
   #t
   (â‰ˆ? doc))

; Verify it's not empty
(âŠ¨ :doc-is-not-empty
   #f
   (â‰ˆâˆ…? doc))

; Verify length is reasonable (should be > 50 chars for header + content)
(âŠ¨ :doc-has-reasonable-length
   #t
   (> (â‰ˆ# doc) #50))

; Print for manual verification
(â‰‹ "Generated documentation for test_doc_module.scm:")
(â‰‹ doc)

;;; ===================================================================
;;; Test 2: Error handling
;;; ===================================================================

; Module not loaded
(â‰” result-not-loaded (ðŸ“– "/tmp/nonexistent.scm"))
(âŠ¨ :doc-unloaded-module-error
   #t
   (âš ? result-not-loaded))

; Wrong argument type
(â‰” result-wrong-type (ðŸ“– #42))
(âŠ¨ :doc-wrong-type-error
   #t
   (âš ? result-wrong-type))

;;; ===================================================================
;;; Test 3: Empty module
;;; ===================================================================

; Create empty module
(â‰‹âŠ² "/tmp/test_empty_module.scm" "")

; Load the empty module
(â‹˜ "/tmp/test_empty_module.scm")

; Generate docs for empty module
(â‰” empty-doc (ðŸ“– "/tmp/test_empty_module.scm"))

; Should return string (even if empty)
(âŠ¨ :empty-doc-is-string
   #t
   (â‰ˆ? empty-doc))

;;; ===================================================================
;;; Test 4: Module with dependencies
;;; ===================================================================

; Create module with dependencies
(â‰‹âŠ² "/tmp/test_base_module.scm" "(â‰” inc (Î» (n) (âŠ• n #1)))")
(â‰‹âŠ² "/tmp/test_derived_module.scm" "(â‹˜ \"/tmp/test_base_module.scm\") (â‰” inc2 (Î» (n) (inc (inc n))))")

; Load derived module
(â‹˜ "/tmp/test_derived_module.scm")

; Generate docs
(â‰” derived-doc (ðŸ“– "/tmp/test_derived_module.scm"))

; Should be a string
(âŠ¨ :derived-doc-is-string
   #t
   (â‰ˆ? derived-doc))

; Print for manual verification
(â‰‹ "Generated documentation for test_derived_module.scm (with dependencies):")
(â‰‹ derived-doc)

;;; ===================================================================
;;; Test 5: Real stdlib module
;;; ===================================================================

; Load a real stdlib module
(â‹˜ "bootstrap/stdlib/option.scm")

; Generate documentation
(â‰” option-doc (ðŸ“– "bootstrap/stdlib/option.scm"))

; Should be a string
(âŠ¨ :stdlib-doc-is-string
   #t
   (â‰ˆ? option-doc))

; Should have substantial content (option.scm has multiple functions)
(âŠ¨ :stdlib-doc-has-content
   #t
   (> (â‰ˆ# option-doc) #200))

; Print documentation for visual inspection
(â‰‹ "")
(â‰‹ "========================================")
(â‰‹ "Generated documentation for option.scm:")
(â‰‹ "========================================")
(â‰‹ option-doc)

;;; ===================================================================
;;; Test 6: Export documentation to file
;;; ===================================================================

; Export simple module docs to file
(â‰” export-result (ðŸ“–â†’ "/tmp/test_doc_module.scm" "/tmp/test_doc_module.md"))

; Should return the output path
(âŠ¨ :doc-export-returns-path
   "/tmp/test_doc_module.md"
   export-result)

; Verify file exists
(âŠ¨ :doc-export-creates-file
   #t
   (â‰‹? "/tmp/test_doc_module.md"))

; Read the file and verify it's not empty
(â‰” exported-content (â‰‹âŠ³ "/tmp/test_doc_module.md"))
(âŠ¨ :doc-export-file-not-empty
   #f
   (â‰ˆâˆ…? exported-content))

; Should match generated docs
(âŠ¨ :doc-export-matches-generate
   doc
   exported-content)

; Export option.scm to file
(â‰” option-export (ðŸ“–â†’ "bootstrap/stdlib/option.scm" "/tmp/option.md"))

(âŠ¨ :option-export-success
   "/tmp/option.md"
   option-export)

(â‰‹ "")
(â‰‹ "Documentation exported to files:")
(â‰‹ "  /tmp/test_doc_module.md")
(â‰‹ "  /tmp/option.md")
