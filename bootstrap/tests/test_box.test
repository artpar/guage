; Test: Mutable References (box) and Sequencing (begin)
; Day 107 - Box create/deref/set/update/swap + sequencing

; ============ Box Create and Deref ============

(define b1 (box #42))
(test-case (quote :box-create-deref) #42 (unbox b1))

; ============ Box Type Check ============

(test-case (quote :box-type-check) #t (box? (box #1)))

; ============ Not a Box ============

(test-case (quote :box-not-box) #f (box? #7))

; ============ Set Returns Old ============

(define b2 (box #10))
(test-case (quote :box-set-returns-old) #10 (box-set! b2 #20))

; ============ Set Updates Value ============

(define b3 (box #100))
(box-set! b3 #200)
(test-case (quote :box-set-updates) #200 (unbox b3))

; ============ Update with Function ============

(define b4 (box #5))
(test-case (quote :box-update-fn) #5 (box-update! b4 (lambda (x) (* x #2))))

; ============ Update Verify New Value ============

(test-case (quote :box-update-fn-verify) #10 (unbox b4))

; ============ Swap Two Boxes ============

(define bx (box :alpha))
(define by (box :beta))
(box-swap! bx by)
(test-case (quote :box-swap) #t (and (equal? (unbox bx) :beta) (equal? (unbox by) :alpha)))

; ============ Sequencing Basic ============

(test-case (quote :seq-basic) #3 (begin #1 #2 #3))

; ============ Sequencing with Mutation ============

(define b5 (box #0))
(test-case (quote :seq-with-mutation) #2
  (begin (box-set! b5 #1) (box-set! b5 #2) (unbox b5)))
