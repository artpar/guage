; Test module system enhancements (Day 70)
; Tests for: module-version (module-version), module-exports (module-exports), module-cycles (module-cycles)

; Load a module to test with
(load "bootstrap/stdlib/list.scm")

; ========== Module Version Tests ==========

; Test 1: Set module version
(test-case :set-version :ok
    (module-version "bootstrap/stdlib/list.scm" "1.0.0"))

; Test 2: Get module version
(test-case :get-version "1.0.0"
    (module-version "bootstrap/stdlib/list.scm"))

; Test 3: Update module version
(module-version "bootstrap/stdlib/list.scm" "1.1.0")
(test-case :update-version "1.1.0"
    (module-version "bootstrap/stdlib/list.scm"))

; Test 4: Non-existent module returns error
(test-case :version-nonexistent #t
    (error? (module-version "nonexistent.scm")))

; ========== Module Exports Tests ==========

; Test 5: Get default exports (all symbols)
(test-case :default-exports-is-list #t
    (pair? (module-exports "bootstrap/stdlib/list.scm")))

; Test 6: Set explicit exports
(test-case :set-exports :ok
    (module-exports "bootstrap/stdlib/list.scm" (quote (:map :filter :foldl))))

; Test 7: Get explicit exports
(define exports (module-exports "bootstrap/stdlib/list.scm"))
(test-case :get-exports-list #t
    (pair? exports))

; Test 8: Exports list has correct count (3)
(define count #0)
(define check-exports exports)
(test-case :exports-is-list #t
    (pair? check-exports))

; ========== Module Cycles Tests ==========

; Test 9: Detect cycles returns list
(test-case :cycles-returns-list #t
    (if (null? (module-cycles "bootstrap/stdlib/list.scm"))
       #t  ; nil is fine - no cycles
       (pair? (module-cycles "bootstrap/stdlib/list.scm"))))

; Test 10: No cycles for normal module (should return nil)
(test-case :no-cycles #t
    (null? (module-cycles "bootstrap/stdlib/list.scm")))
