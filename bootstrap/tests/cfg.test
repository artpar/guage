; CFG (Control Flow Graph) Tests - Phase 2C Week 2

; Define a simple factorial function
(define ! (lambda (n) (if (equal? n #0) #1 (* n (! (- n #1))))))

; Get CFG for factorial
(define cfg (query-cfg (quote !)))

; Test that CFG is a graph
(test-case (quote :cfg-is-graph) #t (graph? cfg (quote :CFG)))

; Test that CFG has nodes
(test-case (quote :cfg-has-nodes) #t (pair? (graph-query cfg (quote :nodes))))

; Test that CFG has edges
(test-case (quote :cfg-has-edges) #t (pair? (graph-query cfg (quote :edges))))

; Test that CFG has entry point
(test-case (quote :cfg-has-entry) #t (number? (graph-query cfg (quote :entry))))

; Test that CFG has exit point
(test-case (quote :cfg-has-exit) #t (number? (graph-query cfg (quote :exit))))

; Define a simple add function (no branches)
(define add (lambda (a b) (+ a b)))

; Get CFG for add
(define cfg-add (query-cfg (quote add)))

; Test add CFG is a graph
(test-case (quote :cfg-add-is-graph) #t (graph? cfg-add (quote :CFG)))

; Test add CFG has nodes
(test-case (quote :cfg-add-has-nodes) #t (pair? (graph-query cfg-add (quote :nodes))))

; Define conditional function
(define max (lambda (a b) (if (> a b) a b)))

; Get CFG for max
(define cfg-max (query-cfg (quote max)))

; Test max CFG is a graph
(test-case (quote :cfg-max-is-graph) #t (graph? cfg-max (quote :CFG)))

; Test max CFG has nodes (should have at least test + branches)
(test-case (quote :cfg-max-has-nodes) #t (pair? (graph-query cfg-max (quote :nodes))))

; Test max CFG has edges (true/false branches)
(test-case (quote :cfg-max-has-edges) #t (pair? (graph-query cfg-max (quote :edges))))
