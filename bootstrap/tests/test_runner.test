; Test Runner - Verify auto-generated test infrastructure works

; ============ Helper Functions ============

; Flatten nested list into single list
(≔ flatten (λ (lst)
  (? (∅? lst)
     ∅
     (? (⟨⟩? (◁ lst))
        (append (flatten (◁ lst)) (flatten (▷ lst)))
        (⟨⟩ (◁ lst) (flatten (▷ lst)))))))

; Append two lists
(≔ append (λ (l1 l2)
  (? (∅? l1)
     l2
     (⟨⟩ (◁ l1) (append (▷ l1) l2)))))

; Count elements in list
(≔ length (λ (lst)
  (? (∅? lst)
     #0
     (⊕ #1 (length (▷ lst))))))

; Execute a single test (test is: (⊨ :name expected actual))
; Returns: ⟨:pass name⟩ or ⟨:fail name expected actual⟩
(≔ execute-test (λ (test)
  (? (∅? test)
     ⟨:error :empty-test⟩
     (≔ name (◁ (▷ test)))
     (≔ expected (◁ (▷ (▷ test))))
     (≔ actual (◁ (▷ (▷ (▷ test)))))
     (? (≟ expected actual)
        ⟨:pass name⟩
        ⟨:fail name expected actual⟩))))

; Count test results by status
(≔ count-status (λ (results status)
  (? (∅? results)
     #0
     (? (≡ (◁ (◁ results)) status)
        (⊕ #1 (count-status (▷ results) status))
        (count-status (▷ results) status)))))

; ============ Tests ============

; Test helpers
(⊨ :flatten-nil ∅ (flatten ∅))
(⊨ :flatten-flat #1 (◁ (flatten (⟨⟩ #1 (⟨⟩ #2 ∅)))))
(⊨ :append-empty (⟨⟩ #1 ∅) (append (⟨⟩ #1 ∅) ∅))
(⊨ :length-0 #0 (length ∅))
(⊨ :length-3 #3 (length (⟨⟩ #1 (⟨⟩ #2 (⟨⟩ #3 ∅)))))
(⊨ :count-empty #0 (count-status ∅ :pass))

; Test auto-generation produces data
(⊨ :gen-add #t (⟨⟩? (⌂⊨ (⌜ ⊕))))
(⊨ :gen-eq #t (⟨⟩? (⌂⊨ (⌜ ≡))))
