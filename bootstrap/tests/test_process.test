;;;
;;; Test: Subprocess via FFI (process.scm)
;;; Day 147
;;;

(load "bootstrap/stdlib/process.scm")

; ============================================================================
; process-capture: capture stdout from commands
; ============================================================================

; Test: echo command
(define echo-out (process-capture "echo hello"))
(test-case :capture-echo "hello\n" echo-out)

; Test: multi-word echo
(define echo2 (process-capture "echo hello world"))
(test-case :capture-echo-multi "hello world\n" echo2)

; Test: printf (no trailing newline control)
(define printf-out (process-capture "printf 'abc'"))
(test-case :capture-printf "abc" printf-out)

; ============================================================================
; process-run: fire-and-forget
; ============================================================================

; Test: true returns 0
(test-case :run-true #0 (process-run "true"))

; ============================================================================
; process-capture-status: output + exit code
; ============================================================================

; Test: successful command
(define cs (process-capture-status "echo ok"))
(test-case :capture-status-code #0 (car cs))
(test-case :capture-status-out "ok\n" (cdr cs))

; ============================================================================
; Symbolic aliases
; ============================================================================

(test-case :alias-capture "hello\n" (⊙⌂⊛ "echo hello"))

; ============================================================================
; Tests complete
; ============================================================================
