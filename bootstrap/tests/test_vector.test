; Test: Vector (vector) — HFT-grade dynamic array with SBO
; Day 114

; 1. Empty creation + size + empty predicate
(test-case (quote :vec-new-empty) #0 (vector-length (vector)))
(test-case (quote :vec-new-empty-pred) #t (vector-empty? (vector)))

; 2. Create from values
(define v1 (vector #1 #2 #3))
(test-case (quote :vec-new-from-values) #3 (vector-length v1))

; 3. O(1) random access
(test-case (quote :vec-get-0) #1 (vector-ref v1 #0))
(test-case (quote :vec-get-1) #2 (vector-ref v1 #1))
(test-case (quote :vec-get-2) #3 (vector-ref v1 #2))

; 4. Set returns old value
(define v2 (vector #10 #20 #30))
(test-case (quote :vec-set-returns-old) #20 (vector-set! v2 #1 #99))

; 5. Set mutates — subsequent get returns new value
(test-case (quote :vec-set-mutates) #99 (vector-ref v2 #1))

; 6. Push/pop LIFO order
(define v3 (vector))
(vector-push! v3 #10)
(vector-push! v3 #20)
(vector-push! v3 #30)
(test-case (quote :vec-pop-lifo-1) #30 (vector-pop! v3))
(test-case (quote :vec-pop-lifo-2) #20 (vector-pop! v3))
(test-case (quote :vec-pop-lifo-3) #10 (vector-pop! v3))

; 7. Empty predicate: empty before push, not-empty after
(define v4 (vector))
(test-case (quote :vec-empty-before) #t (vector-empty? v4))
(vector-push! v4 #1)
(test-case (quote :vec-empty-after) #f (vector-empty? v4))

; 8. To-list preserves order
(define v5 (vector #1 #2 #3))
(test-case (quote :vec-to-list-head) #1 (car (vector->list v5)))

; 9. Type predicate
(test-case (quote :vec-type-pred-yes) #t (vector? (vector)))
(test-case (quote :vec-type-pred-no) #f (vector? #42))

; 10. OOB errors
(test-case (quote :vec-oob-get) #t (error? (vector-ref (vector) #0)))
(test-case (quote :vec-oob-pop) #t (error? (vector-pop! (vector))))

; 11. Slice [1,4) of 5 elements
(define v6 (vector #10 #20 #30 #40 #50))
(define v7 (vector-slice v6 #1 #4))
(test-case (quote :vec-slice-size) #3 (vector-length v7))
(test-case (quote :vec-slice-first) #20 (vector-ref v7 #0))

; 12. Map ×10 over vector
(define v8 (vector #1 #2 #3))
(define v9 (vector-map v8 (lambda (x) (* x #10))))
(test-case (quote :vec-map-0) #10 (vector-ref v9 #0))
(test-case (quote :vec-map-1) #20 (vector-ref v9 #1))
(test-case (quote :vec-map-2) #30 (vector-ref v9 #2))
