; === Day 127: HFT-Grade Refinement Types ===
; Three-tier predicate evaluation with constraint trees

; === Definition ===
(âˆˆâŠ¡ :Positive â„¤ (Î» (x) (> x #0)))
(âˆˆâŠ¡ :NonNeg â„¤ (Î» (x) (â‰¥ x #0)))
(âˆˆâŠ¡ :Even â„¤ (Î» (x) (â‰¡ (% x #2) #0)))
(âˆˆâŠ¡ :Percentage â„¤ (Î» (x) (âˆ§ (â‰¥ x #0) (â‰¤ x #100))))
(âˆˆâŠ¡ :NonZero â„¤ (Î» (x) (â‰¢ x #0)))
(âˆˆâŠ¡ :NonEmpty ğ•Š (Î» (s) (> (â‰ˆ# s) #0)))

; === Check (âˆˆâŠ¡?) ===
(âŠ¨ :pos-5       #t (âˆˆâŠ¡? #5 :Positive))
(âŠ¨ :pos-neg3    #f (âˆˆâŠ¡? #-3 :Positive))
(âŠ¨ :pos-0       #f (âˆˆâŠ¡? #0 :Positive))
(âŠ¨ :nonneg-0    #t (âˆˆâŠ¡? #0 :NonNeg))
(âŠ¨ :nonneg-neg  #f (âˆˆâŠ¡? #-1 :NonNeg))
(âŠ¨ :even-4      #t (âˆˆâŠ¡? #4 :Even))
(âŠ¨ :even-3      #f (âˆˆâŠ¡? #3 :Even))
(âŠ¨ :pct-50      #t (âˆˆâŠ¡? #50 :Percentage))
(âŠ¨ :pct-101     #f (âˆˆâŠ¡? #101 :Percentage))
(âŠ¨ :pct-neg     #f (âˆˆâŠ¡? #-1 :Percentage))
(âŠ¨ :nz-5        #t (âˆˆâŠ¡? #5 :NonZero))
(âŠ¨ :nz-0        #f (âˆˆâŠ¡? #0 :NonZero))
(âŠ¨ :wrong-base  #f (âˆˆâŠ¡? "hello" :Positive))

; === String refinement ===
(âŠ¨ :ne-hello    #t (âˆˆâŠ¡? "hello" :NonEmpty))
(âŠ¨ :ne-empty    #f (âˆˆâŠ¡? "" :NonEmpty))

; === Assert (âˆˆâŠ¡!) ===
(âŠ¨ :assert-ok   #5 (âˆˆâŠ¡! #5 :Positive))
(âŠ¨ :assert-fail #t (âš ? (âˆˆâŠ¡! #-3 :Positive)))
(âŠ¨ :assert-pct  #50 (âˆˆâŠ¡! #50 :Percentage))

; === Introspection ===
(âŠ¨ :base-int    #t (âˆˆâ‰¡ (âˆˆâŠ¡âŠ™ :Positive) (â„¤)))
(âŠ¨ :base-str    #t (âˆˆâ‰¡ (âˆˆâŠ¡âŠ™ :NonEmpty) (ğ•Š)))
(âŠ¨ :pred-fn     #t (â‰¡ (âˆˆâŠ™ (âˆˆâŠ¡â†’ :Positive)) :function))
(âŠ¨ :pred-apply  #t ((âˆˆâŠ¡â†’ :Positive) #5))
(âŠ¨ :undef-err   #t (âš ? (âˆˆâŠ¡âŠ™ :NoSuch)))

; === Constraint tree (âˆˆâŠ¡âŠ¢) ===
(âŠ¨ :con-not-nil #t (Â¬ (âˆ…? (âˆˆâŠ¡âŠ¢ :Positive))))

; === Composition ===
(â‰” pos-even (âˆˆâŠ¡âˆ§ :Positive :Even))
(âŠ¨ :and-4      #t (âˆˆâŠ¡? #4 pos-even))
(âŠ¨ :and-3      #f (âˆˆâŠ¡? #3 pos-even))
(âŠ¨ :and-neg2   #f (âˆˆâŠ¡? #-2 pos-even))

(â‰” pos-or-neg (âˆˆâŠ¡âˆ¨ :Positive :NonNeg))
(âŠ¨ :or-5       #t (âˆˆâŠ¡? #5 pos-or-neg))
(âŠ¨ :or-0       #t (âˆˆâŠ¡? #0 pos-or-neg))

; === Subtyping ===
(âŠ¨ :sub-base   #t (âˆˆâŠ¡âŠ† :Positive â„¤))
(âŠ¨ :sub-any    #t (âˆˆâŠ¡âŠ† :Positive âŠ¤))
(âŠ¨ :sub-wrong  #f (âˆˆâŠ¡âŠ† :Positive ğ•Š))

; === List all ===
(âŠ¨ :list-nonempty #t (Â¬ (âˆ…? (âˆˆâŠ¡âˆ€))))

; === Find matching ===
(âŠ¨ :find-5 #t (Â¬ (âˆ…? (âˆˆâŠ¡âˆˆ #5))))
