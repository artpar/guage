;;;
;;; Tests for Module Index Generation (Day 63 Phase 3)
;;;

;;; ===================================================================
;;; Test 1: Generate index with no modules
;;; ===================================================================

; Clean module state (note: can't actually unload modules, but test with current state)
; Generate index
(â‰” empty-index (ðŸ“–âŠ›))

; Should return a string
(âŠ¨ :index-returns-string
   #t
   (â‰ˆ? empty-index))

; Should not be empty (has header)
(âŠ¨ :index-not-empty
   #f
   (â‰ˆâˆ…? empty-index))

;;; ===================================================================
;;; Test 2: Generate index with modules
;;; ===================================================================

; Load some test modules
(â‰‹âŠ² "/tmp/test_mod1.scm" "(â‰” add1 (Î» (x) (âŠ• x #1)))")
(â‰‹âŠ² "/tmp/test_mod2.scm" "(â‹˜ \"/tmp/test_mod1.scm\") (â‰” add2 (Î» (x) (add1 (add1 x))))")

(â‹˜ "/tmp/test_mod1.scm")
(â‹˜ "/tmp/test_mod2.scm")

; Generate module index
(â‰” index (ðŸ“–âŠ›))

; Verify it's a string
(âŠ¨ :index-with-modules-is-string
   #t
   (â‰ˆ? index))

; Should have substantial content
(âŠ¨ :index-has-content
   #t
   (> (â‰ˆ# index) #100))

; Print for manual verification
(â‰‹ "")
(â‰‹ "========================================")
(â‰‹ "Generated Module Index:")
(â‰‹ "========================================")
(â‰‹ index)

;;; ===================================================================
;;; Test 3: Export index to file
;;; ===================================================================

; Load stdlib module for richer index
(â‹˜ "bootstrap/stdlib/option.scm")

; Generate and export index
(â‰” export-result (ðŸ“–âŠ› "/tmp/module_index.md"))

; Should return the output path
(âŠ¨ :index-export-returns-path
   "/tmp/module_index.md"
   export-result)

; Verify file exists
(âŠ¨ :index-export-creates-file
   #t
   (â‰‹? "/tmp/module_index.md"))

; Read and verify content
(â‰” exported-index (â‰‹âŠ³ "/tmp/module_index.md"))

(âŠ¨ :index-export-not-empty
   #f
   (â‰ˆâˆ…? exported-index))

(âŠ¨ :index-export-has-content
   #t
   (> (â‰ˆ# exported-index) #200))

(â‰‹ "")
(â‰‹ "Index exported to: /tmp/module_index.md")

;;; ===================================================================
;;; Test 4: Index contains cross-references
;;; ===================================================================

; Reload index to verify cross-reference format
(â‰” full-index (ðŸ“–âŠ›))

; Index should mention the test modules we loaded
; (Manual verification in output)

(â‰‹ "")
(â‰‹ "========================================")
(â‰‹ "Full Index with Cross-References:")
(â‰‹ "========================================")
(â‰‹ full-index)
