; Guage Standard Library: List Operations
; Pure symbolic names, named parameters (converted to De Bruijn internally)

; ============================================================================
; Core List Operations
; ============================================================================

; â†¦ :: (Î± â†’ Î²) â†’ [Î±] â†’ [Î²]
; Map - transform each element using function
(â‰” â†¦ (Î» (Æ’) (Î» (lst)
  (? (âˆ…? lst)
     âˆ…
     (âŸ¨âŸ© (Æ’ (â— lst)) ((â†¦ Æ’) (â–· lst)))))))

; âŠ² :: (Î± â†’ ğ”¹) â†’ [Î±] â†’ [Î±]
; Filter - keep only elements satisfying predicate
(â‰” âŠ² (Î» (pred) (Î» (lst)
  (? (âˆ…? lst)
     âˆ…
     (? (pred (â— lst))
        (âŸ¨âŸ© (â— lst) ((âŠ² pred) (â–· lst)))
        ((âŠ² pred) (â–· lst)))))))

; âŠ•â† :: (Î± â†’ Î² â†’ Î±) â†’ Î± â†’ [Î²] â†’ Î±
; Fold-left - accumulate from left to right
(â‰” âŠ•â† (Î» (Æ’) (Î» (acc) (Î» (lst)
  (? (âˆ…? lst)
     acc
     (((âŠ•â† Æ’) ((Æ’ acc) (â— lst))) (â–· lst)))))))

; âŠ•â†’ :: (Î± â†’ Î² â†’ Î²) â†’ [Î±] â†’ Î² â†’ Î²
; Fold-right - accumulate from right to left
(â‰” âŠ•â†’ (Î» (Æ’) (Î» (lst) (Î» (acc)
  (? (âˆ…? lst)
     acc
     ((Æ’ (â— lst)) (((âŠ•â†’ Æ’) (â–· lst)) acc)))))))

; ============================================================================
; List Utilities
; ============================================================================

; # :: [Î±] â†’ â„•
; Length - count elements
(â‰” # (Î» (lst)
  (((âŠ•â† (Î» (acc) (Î» (_) (âŠ• acc #1)))) #0) lst)))

; â§º :: [Î±] â†’ [Î±] â†’ [Î±]
; Append - concatenate two lists
(â‰” â§º (Î» (lst2) (Î» (lst1)
  (((âŠ•â†’ (Î» (x) (Î» (acc) (âŸ¨âŸ© x acc)))) lst1) lst2))))

; â‡„ :: [Î±] â†’ [Î±]
; Reverse - reverse order
(â‰” â‡„ (Î» (lst)
  (((âŠ•â† (Î» (acc) (Î» (x) (âŸ¨âŸ© x acc)))) âˆ…) lst)))

; ============================================================================
; List Slicing
; ============================================================================

; â†‘ :: â„• â†’ [Î±] â†’ [Î±]
; Take - first n elements
(â‰” â†‘ (Î» (n) (Î» (lst)
  (? (â‰¡ n #0)
     âˆ…
     (? (âˆ…? lst)
        âˆ…
        (âŸ¨âŸ© (â— lst) ((â†‘ (âŠ– n #1)) (â–· lst))))))))

; â†“ :: â„• â†’ [Î±] â†’ [Î±]
; Drop - skip first n elements
(â‰” â†“ (Î» (n) (Î» (lst)
  (? (â‰¡ n #0)
     lst
     (? (âˆ…? lst)
        âˆ…
        ((â†“ (âŠ– n #1)) (â–· lst)))))))

; ============================================================================
; List Combinators
; ============================================================================

; âŠ¼ :: [Î±] â†’ [Î²] â†’ [âŸ¨Î± Î²âŸ©]
; Zip - pair corresponding elements
(â‰” âŠ¼ (Î» (lst2) (Î» (lst1)
  (? (âˆ…? lst1)
     âˆ…
     (? (âˆ…? lst2)
        âˆ…
        (âŸ¨âŸ© (âŸ¨âŸ© (â— lst1) (â— lst2)) ((âŠ¼ (â–· lst2)) (â–· lst1))))))))

; âˆƒ :: (Î± â†’ ğ”¹) â†’ [Î±] â†’ ğ”¹
; Exists (any) - test if any element satisfies predicate
(â‰” âˆƒ (Î» (pred) (Î» (lst)
  (? (âˆ…? lst)
     #f
     (? (pred (â— lst))
        #t
        ((âˆƒ pred) (â–· lst)))))))

; âˆ€ :: (Î± â†’ ğ”¹) â†’ [Î±] â†’ ğ”¹
; Forall (all) - test if all elements satisfy predicate
(â‰” âˆ€ (Î» (pred) (Î» (lst)
  (? (âˆ…? lst)
     #t
     (? (pred (â— lst))
        ((âˆ€ pred) (â–· lst))
        #f)))))

; ============================================================================
; List Search
; ============================================================================

; âˆˆ :: Î± â†’ [Î±] â†’ ğ”¹
; Element of (contains) - test membership
(â‰” âˆˆ (Î» (elem) (Î» (lst)
  ((âˆƒ (Î» (x) (â‰¡ elem x))) lst))))

; ============================================================================
; List Building
; ============================================================================

; â‹¯ :: â„• â†’ â„• â†’ [â„•]
; Range - numbers from start to end (exclusive)
(â‰” â‹¯ (Î» (end) (Î» (start)
  (? (â‰¥ start end)
     âˆ…
     (âŸ¨âŸ© start ((â‹¯ end) (âŠ• start #1)))))))

; âŠšâŠš :: â„• â†’ Î± â†’ [Î±]
; Replicate - n copies of value
(â‰” âŠšâŠš (Î» (val) (Î» (n)
  (? (â‰¡ n #0)
     âˆ…
     (âŸ¨âŸ© val ((âŠšâŠš val) (âŠ– n #1)))))))

; ============================================================================
; Advanced List Transformation
; ============================================================================

; âŠ½ :: [âŸ¨Î± Î²âŸ©] â†’ âŸ¨[Î±] [Î²]âŸ©
; Unzip - split paired list into two lists
(â‰” âŠ½ (Î» (pairs)
  ((Î» (fsts) ((Î» (snds)
    (âŸ¨âŸ© fsts snds))
    ((â†¦ â–·) pairs)))
   ((â†¦ â—) pairs))))

; âŠ¤âŠ¥ :: [[Î±]] â†’ [[Î±]]
; Transpose - rotate matrix of lists
(â‰” âŠ¤âŠ¥ (Î» (matrix)
  (? (âˆ…? matrix)
     âˆ…
     (? (âˆ…? (â— matrix))
        âˆ…
        (âŸ¨âŸ© ((â†¦ â—) matrix)
            (âŠ¤âŠ¥ ((â†¦ â–·) matrix)))))))

; Helper for flatten
(â‰” âŠŸ-helper (Î» (acc) (Î» (sublist) ((â§º sublist) acc))))

; âŠŸ :: [[Î±]] â†’ [Î±]
; Flatten - deep list flattening (one level)
(â‰” âŠŸ (Î» (lst)
  (((âŠ•â† âŠŸ-helper) âˆ…) lst)))

; â†¦âŠŸ :: (Î± â†’ [Î²]) â†’ [Î±] â†’ [Î²]
; Flat-map - map function then flatten
(â‰” â†¦âŠŸ (Î» (Æ’) (Î» (lst)
  (âŠŸ ((â†¦ Æ’) lst)))))

; ============================================================================
; Conditional List Operations
; ============================================================================

; â†‘? :: (Î± â†’ ğ”¹) â†’ [Î±] â†’ [Î±]
; Take-while - take elements while predicate true
(â‰” â†‘? (Î» (pred) (Î» (lst)
  (? (âˆ…? lst)
     âˆ…
     (? (pred (â— lst))
        (âŸ¨âŸ© (â— lst) ((â†‘? pred) (â–· lst)))
        âˆ…)))))

; â†“? :: (Î± â†’ ğ”¹) â†’ [Î±] â†’ [Î±]
; Drop-while - drop elements while predicate true
(â‰” â†“? (Î» (pred) (Î» (lst)
  (? (âˆ…? lst)
     âˆ…
     (? (pred (â— lst))
        ((â†“? pred) (â–· lst))
        lst)))))

; âŠ  :: (Î± â†’ ğ”¹) â†’ [Î±] â†’ âŸ¨[Î±] [Î±]âŸ©
; Partition - split into [true, false] by predicate
(â‰” âŠ  (Î» (pred) (Î» (lst)
  ((Î» (trues) ((Î» (falses)
    (âŸ¨âŸ© trues falses))
    ((âŠ² (Î» (x) (Â¬ (pred x)))) lst)))
   ((âŠ² pred) lst)))))

; Helper for group-by: insert into association list
(â‰” âŠ¡-insert (Î» (k) (Î» (v) (Î» (alist)
  (? (âˆ…? alist)
     (âŸ¨âŸ© (âŸ¨âŸ© k (âŸ¨âŸ© v âˆ…)) âˆ…)
     (? (â‰¡ k (â— (â— alist)))
        (âŸ¨âŸ© (âŸ¨âŸ© k (âŸ¨âŸ© v (â–· (â— alist))))
            (â–· alist))
        (âŸ¨âŸ© (â— alist) (((âŠ¡-insert k) v) (â–· alist)))))))))

; âŠ¡ :: (Î± â†’ Î²) â†’ [Î±] â†’ [âŸ¨Î² [Î±]âŸ©]
; Group-by - group elements by key function
(â‰” âŠ¡ (Î» (keyfn) (Î» (lst)
  (((âŠ•â† (Î» (acc) (Î» (x)
    ((Î» (k) (((âŠ¡-insert k) x) acc))
     (keyfn x)))))
   âˆ…)
   lst))))

; ============================================================================
; List Manipulation
; ============================================================================

; Helper for interleave
(â‰” â‹ˆ-helper (Î» (l1) (Î» (l2)
  (? (âˆ…? l1)
     l2
     (? (âˆ…? l2)
        l1
        (âŸ¨âŸ© (â— l1) (âŸ¨âŸ© (â— l2) ((â‹ˆ-helper (â–· l1)) (â–· l2)))))))))

; â‹ˆ :: [Î±] â†’ [Î±] â†’ [Î±]
; Interleave - merge lists alternating elements
(â‰” â‹ˆ â‹ˆ-helper)

; âˆª :: [Î±] â†’ [Î±]
; Deduplicate - remove duplicates (keeps first occurrence)
(â‰” âˆª (Î» (lst)
  (((âŠ•â† (Î» (acc) (Î» (x)
    (? ((âˆˆ x) acc)
       acc
       ((â§º (âŸ¨âŸ© x âˆ…)) acc)))))
   âˆ…)
   lst)))

; âŠ³ :: (Î± â†’ ğ”¹) â†’ [Î±] â†’ Î± | âˆ…
; Find - first element matching predicate (or âˆ…)
(â‰” âŠ³ (Î» (pred) (Î» (lst)
  (? (âˆ…? lst)
     âˆ…
     (? (pred (â— lst))
        (â— lst)
        ((âŠ³ pred) (â–· lst)))))))

; Helper for index-of
(â‰” âŠ³#-helper (Î» (elem) (Î» (lst) (Î» (idx)
  (? (âˆ…? lst)
     âˆ…
     (? (â‰¡ elem (â— lst))
        idx
        (((âŠ³#-helper elem) (â–· lst)) (âŠ• idx #1))))))))

; âŠ³# :: Î± â†’ [Î±] â†’ â„• | âˆ…
; Index-of - position of first matching element (or âˆ…)
(â‰” âŠ³# (Î» (elem) (Î» (lst)
  (((âŠ³#-helper elem) lst) #0))))

; ============================================================================
; Sorting
; ============================================================================

; Comparison wrappers (primitives need wrapping for currying)
(â‰” <â€² (Î» (a) (Î» (b) (< a b))))
(â‰” >â€² (Î» (a) (Î» (b) (> a b))))
(â‰” â‰¤â€² (Î» (a) (Î» (b) (â‰¤ a b))))
(â‰” â‰¥â€² (Î» (a) (Î» (b) (â‰¥ a b))))

; Helper for merge (merge sort)
(â‰” âŠ´-merge (Î» (cmp) (Î» (l1) (Î» (l2)
  (? (âˆ…? l1)
     l2
     (? (âˆ…? l2)
        l1
        (? ((cmp (â— l1)) (â— l2))
           (âŸ¨âŸ© (â— l1) (((âŠ´-merge cmp) (â–· l1)) l2))
           (âŸ¨âŸ© (â— l2) (((âŠ´-merge cmp) l1) (â–· l2))))))))))

; Helper for merge sort
(â‰” âŠ´-sort (Î» (cmp) (Î» (lst)
  (? (âˆ…? lst)
     âˆ…
     (? (âˆ…? (â–· lst))
        lst
        ((Î» (mid) ((Î» (left) ((Î» (right)
          (((âŠ´-merge cmp) ((âŠ´-sort cmp) left)) ((âŠ´-sort cmp) right)))
         ((â†“ mid) lst)))
         ((â†‘ mid) lst)))
        (Ã· (# lst) #2)))))))

; âŠ´ :: (Î± â†’ Î± â†’ ğ”¹) â†’ [Î±] â†’ [Î±]
; Sort - sort with comparison function (merge sort)
(â‰” âŠ´ âŠ´-sort)

; âŠ´< :: (Î± â†’ Î²) â†’ [Î±] â†’ [Î±]
; Sort-by - sort by key function (using <)
(â‰” âŠ´< (Î» (keyfn) (Î» (lst)
  ((âŠ´ (Î» (a) (Î» (b) (< (keyfn a) (keyfn b))))) lst))))

; ============================================================================
; Examples
; ============================================================================

; Sum: (âŠ•â† âŠ• #0 (âŸ¨âŸ© #1 (âŸ¨âŸ© #2 (âŸ¨âŸ© #3 âˆ…))))  ; â†’ #6
; Product: (âŠ•â† âŠ— #1 (âŸ¨âŸ© #2 (âŸ¨âŸ© #3 (âŸ¨âŸ© #4 âˆ…))))  ; â†’ #24
; Map double: (â†¦ (Î» (x) (âŠ— x #2)) (âŸ¨âŸ© #1 (âŸ¨âŸ© #2 (âŸ¨âŸ© #3 âˆ…))))
; Filter >5: (âŠ² (Î» (x) (> x #5)) (âŸ¨âŸ© #3 (âŸ¨âŸ© #7 (âŸ¨âŸ© #2 (âŸ¨âŸ© #9 âˆ…)))))
; Reverse: (â‡„ (âŸ¨âŸ© #1 (âŸ¨âŸ© #2 (âŸ¨âŸ© #3 âˆ…))))
; Range: (â‹¯ #5 #1)  ; â†’ (âŸ¨âŸ© #1 (âŸ¨âŸ© #2 (âŸ¨âŸ© #3 (âŸ¨âŸ© #4 âˆ…))))
; Length: (# (âŸ¨âŸ© #1 (âŸ¨âŸ© #2 (âŸ¨âŸ© #3 âˆ…))))  ; â†’ #3

; Advanced examples:
; Unzip: (âŠ½ (âŸ¨âŸ© (âŸ¨âŸ© #1 #2) (âŸ¨âŸ© (âŸ¨âŸ© #3 #4) âˆ…)))  ; â†’ âŸ¨âŸ¨#1 âŸ¨#3 âˆ…âŸ©âŸ© âŸ¨#2 âŸ¨#4 âˆ…âŸ©âŸ©âŸ©
; Transpose: (âŠ¤âŠ¥ (âŸ¨âŸ© (âŸ¨âŸ© #1 (âŸ¨âŸ© #2 âˆ…)) (âŸ¨âŸ© (âŸ¨âŸ© #3 (âŸ¨âŸ© #4 âˆ…)) âˆ…)))  ; â†’ âŸ¨âŸ¨#1 âŸ¨#3 âˆ…âŸ©âŸ© âŸ¨#2 âŸ¨#4 âˆ…âŸ©âŸ©âŸ©
; Flatten: (âŠŸ (âŸ¨âŸ© (âŸ¨âŸ© #1 (âŸ¨âŸ© #2 âˆ…)) (âŸ¨âŸ© (âŸ¨âŸ© #3 âˆ…) âˆ…)))  ; â†’ âŸ¨#1 âŸ¨#2 âŸ¨#3 âˆ…âŸ©âŸ©âŸ©
; Take-while: (â†‘? (Î» (x) (< x #5)) (âŸ¨âŸ© #1 (âŸ¨âŸ© #2 (âŸ¨âŸ© #7 âˆ…))))  ; â†’ âŸ¨#1 âŸ¨#2 âˆ…âŸ©âŸ©
; Partition: (âŠ  (Î» (x) (â‰¡ (% x #2) #0)) (âŸ¨âŸ© #1 (âŸ¨âŸ© #2 (âŸ¨âŸ© #3 (âŸ¨âŸ© #4 âˆ…)))))  ; â†’ âŸ¨âŸ¨#2 âŸ¨#4 âˆ…âŸ©âŸ© âŸ¨#1 âŸ¨#3 âˆ…âŸ©âŸ©âŸ©
; Interleave: (â‹ˆ (âŸ¨âŸ© #1 (âŸ¨âŸ© #2 âˆ…)) (âŸ¨âŸ© #3 (âŸ¨âŸ© #4 âˆ…)))  ; â†’ âŸ¨#1 âŸ¨#3 âŸ¨#2 âŸ¨#4 âˆ…âŸ©âŸ©âŸ©âŸ©
; Sort: (âŠ´ < (âŸ¨âŸ© #3 (âŸ¨âŸ© #1 (âŸ¨âŸ© #4 (âŸ¨âŸ© #2 âˆ…)))))  ; â†’ âŸ¨#1 âŸ¨#2 âŸ¨#3 âŸ¨#4 âˆ…âŸ©âŸ©âŸ©âŸ©
