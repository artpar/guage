; Structure Primitives Tests - Phase 2C Week 1

; Define Point structure
(⊙≔ (⌜ :Point) (⌜ :x) (⌜ :y))

; Create point instance
(≔ p1 (⊙ (⌜ :Point) #3 #4))

; Test field access
(⊨ (⌜ :point-x) #3 (⊙→ p1 (⌜ :x)))
(⊨ (⌜ :point-y) #4 (⊙→ p1 (⌜ :y)))

; Define Rectangle structure
(⊙≔ (⌜ :Rectangle) (⌜ :width) (⌜ :height) (⌜ :color))

; Create rectangle instance
(≔ r1 (⊙ (⌜ :Rectangle) #10 #20 (⌜ :blue)))

; Test rectangle fields
(⊨ (⌜ :rect-width) #10 (⊙→ r1 (⌜ :width)))
(⊨ (⌜ :rect-height) #20 (⊙→ r1 (⌜ :height)))
(⊨ (⌜ :rect-color) (⌜ :blue) (⊙→ r1 (⌜ :color)))

; Create another point
(≔ p2 (⊙ (⌜ :Point) #7 #8))
(⊨ (⌜ :point2-x) #7 (⊙→ p2 (⌜ :x)))
(⊨ (⌜ :point2-y) #8 (⊙→ p2 (⌜ :y)))

; Test field update (immutable)
(≔ p3 (⊙← p1 (⌜ :x) #100))
(⊨ (⌜ :update-field-x) #100 (⊙→ p3 (⌜ :x)))
(⊨ (⌜ :update-field-y-unchanged) #4 (⊙→ p3 (⌜ :y)))
(⊨ (⌜ :original-unchanged) #3 (⊙→ p1 (⌜ :x)))

; Test type checking
(⊨ (⌜ :is-point) #t (⊙? p1 (⌜ :Point)))
(⊨ (⌜ :is-rect) #t (⊙? r1 (⌜ :Rectangle)))
(⊨ (⌜ :not-rect) #f (⊙? p1 (⌜ :Rectangle)))
(⊨ (⌜ :not-point) #f (⊙? r1 (⌜ :Point)))
(⊨ (⌜ :number-not-struct) #f (⊙? #42 (⌜ :Point)))

; ============ Node/ADT Structure Tests ============

; Define List ADT with two variants
(⊚≔ (⌜ :List) (⟨⟩ (⌜ :Nil) ∅) (⟨⟩ (⌜ :Cons) (⟨⟩ (⌜ :head) (⟨⟩ (⌜ :tail) ∅))))

; Create empty list (Nil variant)
(≔ nil (⊚ (⌜ :List) (⌜ :Nil)))

; Test Nil variant checking
(⊨ (⌜ :nil-is-list-nil) #t (⊚? nil (⌜ :List) (⌜ :Nil)))
(⊨ (⌜ :nil-not-cons) #f (⊚? nil (⌜ :List) (⌜ :Cons)))

; Create list with one element (Cons variant)
(≔ cons1 (⊚ (⌜ :List) (⌜ :Cons) #1 nil))

; Test Cons variant checking
(⊨ (⌜ :cons1-is-list-cons) #t (⊚? cons1 (⌜ :List) (⌜ :Cons)))
(⊨ (⌜ :cons1-not-nil) #f (⊚? cons1 (⌜ :List) (⌜ :Nil)))

; Test field access on Cons
(⊨ (⌜ :cons1-head) #1 (⊚→ cons1 (⌜ :head)))
(⊨ (⌜ :cons1-tail-is-nil) #t (⊚? (⊚→ cons1 (⌜ :tail)) (⌜ :List) (⌜ :Nil)))

; Create list with two elements
(≔ cons2 (⊚ (⌜ :List) (⌜ :Cons) #2 cons1))

; Test nested list
(⊨ (⌜ :cons2-head) #2 (⊚→ cons2 (⌜ :head)))
(⊨ (⌜ :cons2-tail-is-cons) #t (⊚? (⊚→ cons2 (⌜ :tail)) (⌜ :List) (⌜ :Cons)))
(⊨ (⌜ :cons2-tail-head) #1 (⊚→ (⊚→ cons2 (⌜ :tail)) (⌜ :head)))

; Define Tree ADT with two variants
(⊚≔ (⌜ :Tree) (⟨⟩ (⌜ :Leaf) (⟨⟩ (⌜ :value) ∅)) (⟨⟩ (⌜ :Node) (⟨⟩ (⌜ :left) (⟨⟩ (⌜ :right) ∅))))

; Create leaf
(≔ leaf (⊚ (⌜ :Tree) (⌜ :Leaf) #42))

; Test leaf
(⊨ (⌜ :leaf-is-tree-leaf) #t (⊚? leaf (⌜ :Tree) (⌜ :Leaf)))
(⊨ (⌜ :leaf-not-node) #f (⊚? leaf (⌜ :Tree) (⌜ :Node)))
(⊨ (⌜ :leaf-value) #42 (⊚→ leaf (⌜ :value)))

; Create tree node
(≔ left-leaf (⊚ (⌜ :Tree) (⌜ :Leaf) #10))
(≔ right-leaf (⊚ (⌜ :Tree) (⌜ :Leaf) #20))
(≔ node (⊚ (⌜ :Tree) (⌜ :Node) left-leaf right-leaf))

; Test node
(⊨ (⌜ :node-is-tree-node) #t (⊚? node (⌜ :Tree) (⌜ :Node)))
(⊨ (⌜ :node-not-leaf) #f (⊚? node (⌜ :Tree) (⌜ :Leaf)))
(⊨ (⌜ :node-left-is-leaf) #t (⊚? (⊚→ node (⌜ :left)) (⌜ :Tree) (⌜ :Leaf)))
(⊨ (⌜ :node-right-is-leaf) #t (⊚? (⊚→ node (⌜ :right)) (⌜ :Tree) (⌜ :Leaf)))
(⊨ (⌜ :node-left-value) #10 (⊚→ (⊚→ node (⌜ :left)) (⌜ :value)))
(⊨ (⌜ :node-right-value) #20 (⊚→ (⊚→ node (⌜ :right)) (⌜ :value)))

; ============ Graph Structure Tests ============

; Define simple generic graph
(⊝≔ (⌜ :Graph) (⌜ :generic) (⌜ :nodes) (⌜ :edges))

; Create empty graph
(≔ g0 (⊝ (⌜ :Graph)))

; Test empty graph properties
(⊨ (⌜ :empty-graph-nodes) ∅ (⊝→ g0 (⌜ :nodes)))
(⊨ (⌜ :empty-graph-edges) ∅ (⊝→ g0 (⌜ :edges)))

; Add first node
(≔ g1 (⊝⊕ g0 #0))

; Test single node (nodes list is not empty)
(⊨ (⌜ :graph-has-node) #t (⟨⟩? (⊝→ g1 (⌜ :nodes))))

; Add second node
(≔ g2 (⊝⊕ g1 #1))

; Test two nodes (nodes list has tail that is non-empty)
(⊨ (⌜ :graph-has-two-nodes) #t (⟨⟩? (▷ (⊝→ g2 (⌜ :nodes)))))

; Test immutability - original unchanged
(⊨ (⌜ :graph-original-unchanged) ∅ (⊝→ g0 (⌜ :nodes)))

; Create fresh graph for edge testing
(≔ eg (⊝ (⌜ :Graph)))
(≔ eg (⊝⊕ eg #10))
(≔ eg (⊝⊕ eg #20))

; Add single edge
(≔ eg2 (⊝⊗ eg #10 #20 (⌜ :connects)))

; Test edge exists
(⊨ (⌜ :graph-has-edge) #t (⟨⟩? (⊝→ eg2 (⌜ :edges))))

; Test graph type checking
(⊨ (⌜ :is-graph) #t (⊝? g0 (⌜ :Graph)))
(⊨ (⌜ :is-graph-with-nodes) #t (⊝? g2 (⌜ :Graph)))
(⊨ (⌜ :number-not-graph) #f (⊝? #42 (⌜ :Graph)))
(⊨ (⌜ :struct-not-graph) #f (⊝? p1 (⌜ :Graph)))

; Define CFG graph type
(⊝≔ (⌜ :CFG) (⌜ :cfg) (⌜ :nodes) (⌜ :edges) (⌜ :entry) (⌜ :exit))

; Create CFG instance
(≔ cfg (⊝ (⌜ :CFG)))

; Test CFG is a graph
(⊨ (⌜ :cfg-is-graph) #t (⊝? cfg (⌜ :CFG)))

; Test CFG entry/exit (should be ∅ for empty CFG)
(⊨ (⌜ :cfg-no-entry) ∅ (⊝→ cfg (⌜ :entry)))
(⊨ (⌜ :cfg-no-exit) ∅ (⊝→ cfg (⌜ :exit)))
